<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Side-by-Side Translation Editor - Portfolio CMS</title>
    <link rel="stylesheet" href="design-system.css">
    <style>
        .translation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            height: calc(100vh - 200px);
            margin: 1rem 0;
        }

        .editor-panel {
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .editor-header {
            background: var(--bg-secondary);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-stats {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .editor-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .frontmatter-editor {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem;
        }

        .frontmatter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .frontmatter-field {
            display: flex;
            flex-direction: column;
        }

        .frontmatter-field label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .frontmatter-field input {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--card-bg);
        }

        .content-editor {
            flex: 1;
            position: relative;
        }

        .content-textarea {
            width: 100%;
            height: 100%;
            border: none;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            background: var(--card-bg);
            color: var(--text-primary);
            resize: none;
            outline: none;
        }

        .translation-memory {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            max-height: 400px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .translation-memory.collapsed {
            transform: translateY(-50%) translateX(calc(100% - 40px));
        }

        .memory-header {
            background: var(--accent-color);
            color: white;
            padding: 1rem;
            cursor: pointer;
            user-select: none;
        }

        .memory-content {
            max-height: 350px;
            overflow-y: auto;
            padding: 1rem;
        }

        .memory-term {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .term-source {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .term-target {
            color: var(--text-secondary);
            font-style: italic;
        }

        .sync-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--accent-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sync-indicator.visible {
            opacity: 1;
        }

        .toolbar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            padding: 0.375rem 0.75rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toolbar-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .progress-indicator {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .translation-suggestions {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 0.75rem;
            max-height: 120px;
            overflow-y: auto;
        }

        .suggestion {
            display: block;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: var(--card-bg);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s ease;
        }

        .suggestion:hover {
            background: var(--accent-color);
            color: white;
        }

        .cultural-note {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
            padding: 0.75rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }

        @media (max-width: 1200px) {
            .translation-memory {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .translation-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .toolbar {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="admin-container">
        <header class="admin-header">
            <div class="header-content">
                <h1>‚úèÔ∏è Side-by-Side Translation Editor</h1>
                <div class="header-actions">
                    <select id="file-selector" class="form-control">
                        <option value="">Select a file to translate...</option>
                    </select>
                    <button class="btn btn-secondary" onclick="saveBothVersions()">üíæ Save Both</button>
                    <button class="btn btn-primary" onclick="publishTranslations()">üöÄ Publish</button>
                </div>
            </div>
        </header>

        <main class="admin-main">
            <div class="toolbar">
                <button class="toolbar-btn" onclick="copyToTranslation()">üìã Copy Source</button>
                <button class="toolbar-btn" onclick="translateSelected()">üåç Translate Selection</button>
                <button class="toolbar-btn" onclick="checkTerminology()">üìö Check Terms</button>
                <button class="toolbar-btn" onclick="validateSEO()">üîç SEO Check</button>
                <button class="toolbar-btn" onclick="previewChanges()">üëÅÔ∏è Preview</button>
                <button class="toolbar-btn" onclick="toggleMemory()">üß† Memory</button>
            </div>

            <div class="translation-container">
                <div class="editor-panel">
                    <div class="editor-header">
                        <div class="editor-title">
                            üá∫üá∏ English (Source)
                        </div>
                        <div class="editor-stats" id="en-stats">
                            0 words
                        </div>
                    </div>
                    
                    <div class="editor-content">
                        <div class="frontmatter-editor">
                            <h4>Front Matter</h4>
                            <div class="frontmatter-grid">
                                <div class="frontmatter-field">
                                    <label>Title</label>
                                    <input type="text" id="en-title" placeholder="Page title...">
                                </div>
                                <div class="frontmatter-field">
                                    <label>Description</label>
                                    <input type="text" id="en-description" placeholder="Meta description...">
                                </div>
                            </div>
                            <div class="progress-indicator" id="en-progress">
                                Ready to edit
                            </div>
                        </div>
                        
                        <div class="content-editor">
                            <textarea 
                                id="en-content" 
                                class="content-textarea" 
                                placeholder="English content will appear here..."
                                oninput="updateStats('en'); syncScroll(this, 'es-content'); checkTerminology()"
                                onscroll="syncScroll(this, 'es-content')"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <div class="editor-panel">
                    <div class="editor-header">
                        <div class="editor-title">
                            üá™üá∏ Espa√±ol (Translation)
                        </div>
                        <div class="editor-stats" id="es-stats">
                            0 palabras
                        </div>
                    </div>
                    
                    <div class="editor-content">
                        <div class="frontmatter-editor">
                            <h4>Front Matter</h4>
                            <div class="frontmatter-grid">
                                <div class="frontmatter-field">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="es-title" placeholder="T√≠tulo de la p√°gina...">
                                </div>
                                <div class="frontmatter-field">
                                    <label>Descripci√≥n</label>
                                    <input type="text" id="es-description" placeholder="Meta descripci√≥n...">
                                </div>
                            </div>
                            
                            <div class="cultural-note">
                                üá®üá¥ <strong>Colombia Context:</strong> Consider local expressions and cultural references
                            </div>
                            
                            <div class="progress-indicator" id="es-progress">
                                Listo para editar
                            </div>
                        </div>
                        
                        <div class="content-editor">
                            <textarea 
                                id="es-content" 
                                class="content-textarea" 
                                placeholder="Spanish translation will appear here..."
                                oninput="updateStats('es'); syncScroll(this, 'en-content'); suggestTranslations()"
                                onscroll="syncScroll(this, 'en-content')"
                            ></textarea>
                        </div>
                        
                        <div class="translation-suggestions" id="suggestions-panel" style="display: none;">
                            <div class="suggestions-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Translation Memory Panel -->
    <div class="translation-memory" id="translation-memory">
        <div class="memory-header" onclick="toggleMemory()">
            üß† Translation Memory
        </div>
        <div class="memory-content" id="memory-content">
            <div class="memory-term">
                <div class="term-source">Portfolio</div>
                <div class="term-target">Portafolio</div>
            </div>
            <div class="memory-term">
                <div class="term-source">Language Learning</div>
                <div class="term-target">Aprendizaje de Idiomas</div>
            </div>
            <div class="memory-term">
                <div class="term-source">Teaching</div>
                <div class="term-target">Ense√±anza</div>
            </div>
            <div class="memory-term">
                <div class="term-source">Technology</div>
                <div class="term-target">Tecnolog√≠a</div>
            </div>
        </div>
    </div>

    <!-- Sync Indicator -->
    <div class="sync-indicator" id="sync-indicator">
        ‚úì Changes saved
    </div>

    <script>
        class TranslationEditor {
            constructor() {
                this.apiBaseUrl = window.location.origin.replace('1313', '3000');
                this.translationMemory = new Map();
                this.currentFile = null;
                this.autoSaveInterval = null;
                this.init();
            }

            async init() {
                await this.loadFilesList();
                this.initializeEditor();
                this.loadTranslationMemory();
                this.setupAutoSave();
                
                // Check for file parameter in URL
                const urlParams = new URLSearchParams(window.location.search);
                const file = urlParams.get('file');
                if (file) {
                    await this.loadFile(file);
                }
            }

            async loadFilesList() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/content`);
                    if (!response.ok) {
                        this.loadMockFilesList();
                        return;
                    }
                    const data = await response.json();
                    this.populateFilesList(data.files);
                } catch (error) {
                    console.log('Loading mock files list');
                    this.loadMockFilesList();
                }
            }

            loadMockFilesList() {
                const mockFiles = [
                    { path: '_index.md', title: 'Homepage', type: 'page' },
                    { path: 'me/_index.md', title: 'About Me', type: 'page' },
                    { path: 'tools/_index.md', title: 'Tools', type: 'page' },
                    { path: 'services/_index.md', title: 'Services', type: 'page' },
                    { path: 'cv/_index.md', title: 'CV', type: 'page' },
                    { path: 'blog/_index.md', title: 'Blog', type: 'blog' }
                ];
                this.populateFilesList(mockFiles);
            }

            populateFilesList(files) {
                const selector = document.getElementById('file-selector');
                selector.innerHTML = '<option value="">Select a file to translate...</option>';
                
                files.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file.path;
                    option.textContent = `${file.title || file.path} (${file.type})`;
                    selector.appendChild(option);
                });

                selector.addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.loadFile(e.target.value);
                    }
                });
            }

            async loadFile(filePath) {
                this.currentFile = filePath;
                
                try {
                    // Load English version
                    const enResponse = await fetch(`${this.apiBaseUrl}/api/content/${filePath}`);
                    if (enResponse.ok) {
                        const enData = await enResponse.json();
                        this.populateEditor('en', enData);
                    }

                    // Load Spanish version
                    const esPath = filePath.startsWith('es/') ? filePath : `es/${filePath}`;
                    const esResponse = await fetch(`${this.apiBaseUrl}/api/content/${esPath}`);
                    if (esResponse.ok) {
                        const esData = await esResponse.json();
                        this.populateEditor('es', esData);
                    } else {
                        // Create empty Spanish version
                        this.populateEditor('es', { frontmatter: {}, content: '' });
                    }
                } catch (error) {
                    console.error('Error loading file:', error);
                    this.loadMockContent();
                }
            }

            loadMockContent() {
                const mockEn = {
                    frontmatter: {
                        title: 'Welcome to My Portfolio',
                        description: 'Creator working at the intersection of technology and art'
                    },
                    content: `# Welcome

I'm Brandon Lambert, a creator working at the intersection of technology and art. I specialize in language learning tools, educational technology, and web development.

## What I Do

- Build innovative language learning applications
- Create educational content and tools
- Develop modern web applications
- Teach and share knowledge about technology

## My Approach

I believe in creating meaningful connections through technology, making learning accessible, and building tools that genuinely help people grow.`
                };

                const mockEs = {
                    frontmatter: {
                        title: 'Bienvenido a Mi Portafolio',
                        description: 'Creador trabajando en la intersecci√≥n de tecnolog√≠a y arte'
                    },
                    content: `# Bienvenido

Soy Brandon Lambert, un creador trabajando en la intersecci√≥n de tecnolog√≠a y arte. Me especializo en herramientas de aprendizaje de idiomas, tecnolog√≠a educativa y desarrollo web.

## Lo Que Hago

- Construyo aplicaciones innovadoras para el aprendizaje de idiomas
- Creo contenido y herramientas educativas
- Desarrollo aplicaciones web modernas
- Ense√±o y comparto conocimiento sobre tecnolog√≠a

## Mi Enfoque

Creo en crear conexiones significativas a trav√©s de la tecnolog√≠a, hacer el aprendizaje accesible, y construir herramientas que genuinamente ayuden a las personas a crecer.`
                };

                this.populateEditor('en', mockEn);
                this.populateEditor('es', mockEs);
            }

            populateEditor(lang, data) {
                document.getElementById(`${lang}-title`).value = data.frontmatter.title || '';
                document.getElementById(`${lang}-description`).value = data.frontmatter.description || '';
                document.getElementById(`${lang}-content`).value = data.content || '';
                
                this.updateStats(lang);
            }

            initializeEditor() {
                // Sync scrolling between editors
                this.setupScrollSync();
            }

            setupScrollSync() {
                let isScrolling = false;
                
                ['en-content', 'es-content'].forEach(id => {
                    document.getElementById(id).addEventListener('scroll', (e) => {
                        if (isScrolling) return;
                        isScrolling = true;
                        
                        const other = id === 'en-content' ? 'es-content' : 'en-content';
                        const otherEl = document.getElementById(other);
                        const scrollPercent = e.target.scrollTop / (e.target.scrollHeight - e.target.clientHeight);
                        otherEl.scrollTop = scrollPercent * (otherEl.scrollHeight - otherEl.clientHeight);
                        
                        setTimeout(() => { isScrolling = false; }, 50);
                    });
                });
            }

            updateStats(lang) {
                const content = document.getElementById(`${lang}-content`).value;
                const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
                const label = lang === 'en' ? 'words' : 'palabras';
                document.getElementById(`${lang}-stats`).textContent = `${wordCount} ${label}`;
                
                // Update progress
                const progress = document.getElementById(`${lang}-progress`);
                if (wordCount === 0) {
                    progress.textContent = lang === 'en' ? 'Ready to edit' : 'Listo para editar';
                } else {
                    const readyText = lang === 'en' ? 'Content added' : 'Contenido agregado';
                    progress.textContent = `${readyText} - ${wordCount} ${label}`;
                }
            }

            loadTranslationMemory() {
                // Load common terms for Brandon's portfolio
                this.translationMemory.set('portfolio', 'portafolio');
                this.translationMemory.set('language learning', 'aprendizaje de idiomas');
                this.translationMemory.set('teaching', 'ense√±anza');
                this.translationMemory.set('technology', 'tecnolog√≠a');
                this.translationMemory.set('education', 'educaci√≥n');
                this.translationMemory.set('tools', 'herramientas');
                this.translationMemory.set('creative', 'creativo');
                this.translationMemory.set('development', 'desarrollo');
                this.translationMemory.set('experience', 'experiencia');
                this.translationMemory.set('Colombia', 'Colombia');
                this.translationMemory.set('Spanish', 'espa√±ol');
                this.translationMemory.set('English', 'ingl√©s');
            }

            setupAutoSave() {
                this.autoSaveInterval = setInterval(() => {
                    this.saveProgress();
                }, 30000); // Auto-save every 30 seconds
            }

            async saveProgress() {
                if (!this.currentFile) return;
                
                const indicator = document.getElementById('sync-indicator');
                indicator.textContent = 'Saving...';
                indicator.classList.add('visible');
                
                // Simulate save (in real implementation, save to backend)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                indicator.textContent = '‚úì Changes saved';
                setTimeout(() => {
                    indicator.classList.remove('visible');
                }, 2000);
            }

            checkTerminology() {
                const enContent = document.getElementById('en-content').value.toLowerCase();
                const memoryPanel = document.getElementById('memory-content');
                
                // Highlight relevant terms in translation memory
                memoryPanel.innerHTML = '';
                
                this.translationMemory.forEach((translation, term) => {
                    if (enContent.includes(term.toLowerCase())) {
                        const termEl = document.createElement('div');
                        termEl.className = 'memory-term';
                        termEl.innerHTML = `
                            <div class="term-source">${term}</div>
                            <div class="term-target">${translation}</div>
                        `;
                        memoryPanel.appendChild(termEl);
                    }
                });
            }
        }

        // Global functions
        let editor;

        document.addEventListener('DOMContentLoaded', () => {
            editor = new TranslationEditor();
        });

        function updateStats(lang) {
            editor.updateStats(lang);
        }

        function syncScroll(source, targetId) {
            // Handled in setupScrollSync
        }

        function checkTerminology() {
            editor.checkTerminology();
        }

        function copyToTranslation() {
            const enContent = document.getElementById('en-content').value;
            document.getElementById('es-content').value = enContent;
            editor.updateStats('es');
        }

        function translateSelected() {
            alert('AI translation feature would integrate with Google Translate or similar service.');
        }

        function validateSEO() {
            alert('SEO validation would check title length, description, and keyword usage.');
        }

        function previewChanges() {
            window.open('/admin/preview.html?file=' + encodeURIComponent(editor.currentFile), '_blank');
        }

        function toggleMemory() {
            const memory = document.getElementById('translation-memory');
            memory.classList.toggle('collapsed');
        }

        function saveBothVersions() {
            editor.saveProgress();
        }

        function publishTranslations() {
            alert('Publishing would build the Hugo site and deploy changes.');
        }

        function suggestTranslations() {
            // Show translation suggestions based on context
            const suggestionsPanel = document.getElementById('suggestions-panel');
            suggestionsPanel.style.display = 'block';
            
            const content = suggestionsPanel.querySelector('.suggestions-content');
            content.innerHTML = `
                <div class="suggestion" onclick="insertSuggestion(this.textContent)">Considere usar "tecnolog√≠a educativa"</div>
                <div class="suggestion" onclick="insertSuggestion(this.textContent)">Recomendaci√≥n: "aprendizaje personalizado"</div>
            `;
        }

        function insertSuggestion(text) {
            const textarea = document.getElementById('es-content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const current = textarea.value;
            
            textarea.value = current.substring(0, start) + text + current.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + text.length, start + text.length);
            
            editor.updateStats('es');
        }
    </script>
</body>
</html>