<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Test Runner</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 0.5rem;
        }
        
        .test-results {
            margin: 1rem 0;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 0.25rem;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .pass { color: #22c55e; }
        .fail { color: #ef4444; }
        .warn { color: #f59e0b; }
        .info { color: #3b82f6; }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .theme-controls {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .summary {
            padding: 1rem;
            background: #e0f2fe;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .contrast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .contrast-sample {
            padding: 1rem;
            border-radius: 0.25rem;
            text-align: center;
            font-weight: 500;
        }
        
        .focus-test-area {
            border: 2px dashed #ccc;
            padding: 2rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
        }
        
        .focus-test-area button,
        .focus-test-area a,
        .focus-test-area input {
            margin: 0.5rem;
        }
    </style>
</head>
<body>
    <h1>Dark Mode Accessibility Testing Suite</h1>
    
    <div class="summary">
        <h2>Test Summary</h2>
        <div id="test-summary">
            <p>Run tests to see summary...</p>
        </div>
    </div>
    
    <div class="theme-controls">
        <h3>Theme Controls</h3>
        <button onclick="setTheme('light')">Light Theme</button>
        <button onclick="setTheme('dark')">Dark Theme</button>
        <button onclick="setTheme('auto')">Auto Theme</button>
        <p>Current theme: <span id="current-theme">Unknown</span></p>
    </div>
    
    <div class="test-section">
        <h2>1. Contrast Testing</h2>
        <button onclick="runContrastTests()">Run Contrast Tests</button>
        <div id="contrast-results" class="test-results"></div>
        
        <h3>Live Contrast Samples</h3>
        <div id="contrast-samples" class="contrast-grid"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Keyboard Navigation Testing</h2>
        <button onclick="runKeyboardTests()">Run Keyboard Tests</button>
        <div id="keyboard-results" class="test-results"></div>
        
        <h3>Focus Test Area</h3>
        <div class="focus-test-area">
            <p>Tab through these elements to test focus indicators:</p>
            <button>Test Button 1</button>
            <a href="#test">Test Link</a>
            <input type="text" placeholder="Test Input">
            <button class="theme-toggle">Theme Toggle Test</button>
            <a href="#skip" class="skip-link">Skip Link Test</a>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3. Visual Accessibility Testing</h2>
        <button onclick="runVisualTests()">Run Visual Tests</button>
        <div id="visual-results" class="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Screen Reader Testing</h2>
        <button onclick="runScreenReaderTests()">Run Screen Reader Tests</button>
        <div id="sr-results" class="test-results"></div>
        
        <div aria-live="polite" id="announcements"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Complete Accessibility Report</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="downloadReport()">Download Report</button>
        <div id="complete-results" class="test-results"></div>
    </div>

    <script>
        // Load test modules
        let ContrastChecker, KeyboardNavigationTester, VisualAccessibilityTester;
        let allTestResults = {};
        
        // Theme management
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateCurrentTheme();
            updateContrastSamples();
        }
        
        function updateCurrentTheme() {
            const theme = document.documentElement.getAttribute('data-theme') || 'light';
            document.getElementById('current-theme').textContent = theme;
        }
        
        // Create contrast samples
        function updateContrastSamples() {
            const samplesContainer = document.getElementById('contrast-samples');
            const theme = document.documentElement.getAttribute('data-theme') || 'light';
            
            const colors = theme === 'dark' ? {
                bg: '#1a1a1a',
                text: '#ffffff', 
                primary: '#4d94ff',
                secondary: '#ff4d94',
                surface: '#2a2a2a'
            } : {
                bg: '#ffffff',
                text: '#1a1a1a',
                primary: '#0066ff', 
                secondary: '#ff0066',
                surface: '#f8f8f8'
            };
            
            samplesContainer.innerHTML = `
                <div class="contrast-sample" style="background: ${colors.bg}; color: ${colors.text}; border: 1px solid ${colors.text}">
                    Body Text on Background
                </div>
                <div class="contrast-sample" style="background: ${colors.bg}; color: ${colors.primary};">
                    Primary Links
                </div>
                <div class="contrast-sample" style="background: ${colors.surface}; color: ${colors.text};">
                    Surface Text
                </div>
                <div class="contrast-sample" style="background: ${colors.bg}; color: ${colors.secondary};">
                    Secondary Text
                </div>
            `;
        }
        
        // Test runners
        async function runContrastTests() {
            const results = document.getElementById('contrast-results');
            results.textContent = 'Running contrast tests...';
            
            try {
                // Load and run contrast checker
                const checker = new ContrastChecker();
                const testResults = checker.testColors();
                const report = checker.generateReport();
                
                allTestResults.contrast = testResults;
                results.innerHTML = formatReport(report);
                updateTestSummary();
            } catch (error) {
                results.textContent = `Error: ${error.message}`;
            }
        }
        
        async function runKeyboardTests() {
            const results = document.getElementById('keyboard-results');
            results.textContent = 'Running keyboard navigation tests...';
            
            try {
                const tester = new KeyboardNavigationTester();
                const testResults = tester.runAllTests();
                const report = tester.generateReport(testResults);
                
                allTestResults.keyboard = testResults;
                results.innerHTML = formatReport(report);
                updateTestSummary();
            } catch (error) {
                results.textContent = `Error: ${error.message}`;
            }
        }
        
        async function runVisualTests() {
            const results = document.getElementById('visual-results');
            results.textContent = 'Running visual accessibility tests...';
            
            try {
                const tester = new VisualAccessibilityTester();
                const testResults = tester.runAllTests();
                const report = tester.generateReport(testResults);
                
                allTestResults.visual = testResults;
                results.innerHTML = formatReport(report);
                updateTestSummary();
            } catch (error) {
                results.textContent = `Error: ${error.message}`;
            }
        }
        
        async function runScreenReaderTests() {
            const results = document.getElementById('sr-results');
            results.textContent = 'Running screen reader tests...';
            
            // Test live regions
            const announcements = document.getElementById('announcements');
            announcements.textContent = 'Testing live region announcement';
            
            setTimeout(() => {
                announcements.textContent = 'Live region test complete';
            }, 1000);
            
            // Basic screen reader checks
            const report = `
# Screen Reader Testing

## Live Regions
✅ **Announcement test**: Live regions are functional

## Semantic Structure
${document.querySelector('main') ? '✅' : '❌'} **Main landmark**: ${document.querySelector('main') ? 'Present' : 'Missing'}
${document.querySelector('nav') ? '✅' : '❌'} **Navigation**: ${document.querySelector('nav') ? 'Present' : 'Missing'}
${document.querySelector('h1') ? '✅' : '❌'} **Page heading**: ${document.querySelector('h1') ? 'Present' : 'Missing'}

## ARIA Attributes
${document.querySelector('[aria-label], [aria-labelledby]') ? '✅' : 'ℹ️'} **ARIA labels**: ${document.querySelector('[aria-label], [aria-labelledby]') ? 'Found' : 'None found'}
${document.querySelector('[role]') ? '✅' : 'ℹ️'} **ARIA roles**: ${document.querySelector('[role]') ? 'Present' : 'None found'}

## Form Labels
${document.querySelectorAll('input').length === document.querySelectorAll('label').length ? '✅' : '⚠️'} **Input labels**: ${document.querySelectorAll('label').length}/${document.querySelectorAll('input').length} inputs labeled
            `;
            
            allTestResults.screenReader = report;
            results.innerHTML = formatReport(report);
            updateTestSummary();
        }
        
        async function runAllTests() {
            const results = document.getElementById('complete-results');
            results.textContent = 'Running complete accessibility test suite...';
            
            await runContrastTests();
            await runKeyboardTests();
            await runVisualTests();
            await runScreenReaderTests();
            
            // Generate complete report
            const completeReport = generateCompleteReport();
            results.innerHTML = formatReport(completeReport);
        }
        
        function generateCompleteReport() {
            const timestamp = new Date().toISOString();
            const theme = document.documentElement.getAttribute('data-theme') || 'light';
            
            let report = `# Complete Accessibility Test Report\n\n`;
            report += `**Date**: ${timestamp}\n`;
            report += `**Theme**: ${theme}\n`;
            report += `**URL**: ${window.location.href}\n\n`;
            
            // Count results
            let totalTests = 0;
            let passedTests = 0;
            let failedTests = 0;
            let warnings = 0;
            
            Object.values(allTestResults).forEach(section => {
                if (Array.isArray(section)) {
                    section.forEach(group => {
                        if (group.tests) {
                            group.tests.forEach(test => {
                                totalTests++;
                                if (test.status === 'PASS') passedTests++;
                                else if (test.status === 'FAIL') failedTests++;
                                else if (test.status === 'WARN') warnings++;
                            });
                        }
                    });
                } else if (typeof section === 'object' && section.ratio) {
                    // Contrast results
                    totalTests++;
                    if (section.status === 'PASS') passedTests++;
                    else if (section.status === 'FAIL') failedTests++;
                }
            });
            
            report += `## Summary\n`;
            report += `- **Total Tests**: ${totalTests}\n`;
            report += `- **Passed**: ${passedTests} (${Math.round(passedTests/totalTests*100)}%)\n`;
            report += `- **Failed**: ${failedTests}\n`;
            report += `- **Warnings**: ${warnings}\n\n`;
            
            // Add detailed results
            if (allTestResults.contrast) {
                report += `## Contrast Testing\n`;
                if (Array.isArray(allTestResults.contrast)) {
                    allTestResults.contrast.forEach(result => {
                        report += `### ${result.theme} - ${result.element}\n`;
                        report += `- Ratio: ${result.ratio}:1\n`;
                        report += `- WCAG AA: ${result.wcagAA ? '✅ PASS' : '❌ FAIL'}\n\n`;
                    });
                }
            }
            
            if (allTestResults.keyboard) {
                report += `## Keyboard Navigation\n`;
                allTestResults.keyboard.forEach(section => {
                    report += `### ${section.element}\n`;
                    section.tests.forEach(test => {
                        const icon = test.status === 'PASS' ? '✅' : test.status === 'FAIL' ? '❌' : 'ℹ️';
                        report += `- ${icon} ${test.test}: ${test.message}\n`;
                    });
                    report += '\n';
                });
            }
            
            if (allTestResults.visual) {
                report += `## Visual Accessibility\n`;
                allTestResults.visual.forEach(section => {
                    report += `### ${section.element}\n`;
                    section.tests.forEach(test => {
                        const icon = test.status === 'PASS' ? '✅' : 
                                    test.status === 'FAIL' ? '❌' : 
                                    test.status === 'WARN' ? '⚠️' : 'ℹ️';
                        report += `- ${icon} ${test.test}: ${test.message}\n`;
                    });
                    report += '\n';
                });
            }
            
            report += `## Recommendations\n\n`;
            
            if (failedTests > 0) {
                report += `### Critical Issues (${failedTests})\n`;
                report += `- Review all failed tests above\n`;
                report += `- Focus on WCAG AA compliance (4.5:1 contrast minimum)\n`;
                report += `- Ensure all interactive elements are keyboard accessible\n\n`;
            }
            
            if (warnings > 0) {
                report += `### Improvements (${warnings})\n`;
                report += `- Address warning items for better accessibility\n`;
                report += `- Consider WCAG AAA compliance (7:1 contrast) for important content\n`;
                report += `- Test with actual screen readers\n\n`;
            }
            
            report += `### Testing Recommendations\n`;
            report += `- Test with NVDA, JAWS, or VoiceOver screen readers\n`;
            report += `- Test keyboard navigation without mouse\n`;
            report += `- Verify with automated tools like axe-core\n`;
            report += `- Test with users who have disabilities\n`;
            
            return report;
        }
        
        function updateTestSummary() {
            const summary = document.getElementById('test-summary');
            const testsRun = Object.keys(allTestResults).length;
            summary.innerHTML = `
                <p><strong>Tests completed:</strong> ${testsRun}/4</p>
                <p><strong>Current theme:</strong> ${document.documentElement.getAttribute('data-theme') || 'light'}</p>
                <p><strong>Status:</strong> ${testsRun === 4 ? 'Complete' : 'In progress'}</p>
            `;
        }
        
        function formatReport(reportText) {
            return reportText
                .replace(/^# (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h4>$1</h4>')
                .replace(/^### (.+)$/gm, '<h5>$1</h5>')
                .replace(/✅/g, '<span class="pass">✅</span>')
                .replace(/❌/g, '<span class="fail">❌</span>')
                .replace(/⚠️/g, '<span class="warn">⚠️</span>')
                .replace(/ℹ️/g, '<span class="info">ℹ️</span>')
                .replace(/\n/g, '<br>');
        }
        
        function downloadReport() {
            const report = generateCompleteReport();
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `accessibility-report-${new Date().toISOString().slice(0,10)}.md`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTheme();
            updateContrastSamples();
            
            // Load CSS custom properties for dynamic theme
            const root = document.documentElement;
            root.style.setProperty('--color-bg', '#ffffff');
            root.style.setProperty('--color-text', '#1a1a1a');
            root.style.setProperty('--color-primary', '#0066ff');
            root.style.setProperty('--color-secondary', '#ff0066');
            root.style.setProperty('--color-border', '#e5e5e5');
            root.style.setProperty('--color-surface', '#f8f8f8');
            
            // Dark theme styles
            const style = document.createElement('style');
            style.textContent = `
                [data-theme="dark"] {
                    --color-bg: #1a1a1a;
                    --color-text: #ffffff;
                    --color-primary: #4d94ff;
                    --color-secondary: #ff4d94;
                    --color-border: #333333;
                    --color-surface: #2a2a2a;
                }
                
                [data-theme="dark"] body {
                    background: var(--color-bg);
                    color: var(--color-text);
                }
                
                [data-theme="dark"] .test-section {
                    border-color: var(--color-border);
                    background: var(--color-surface);
                }
                
                [data-theme="dark"] .test-results {
                    background: var(--color-surface);
                    color: var(--color-text);
                }
                
                [data-theme="dark"] .theme-controls,
                [data-theme="dark"] .summary {
                    background: var(--color-surface);
                    color: var(--color-text);
                }
                
                .skip-link {
                    position: absolute;
                    top: -40px;
                    left: 0;
                    background: var(--color-bg);
                    color: var(--color-text);
                    padding: 0.5rem 1rem;
                    text-decoration: none;
                    z-index: 1000;
                }
                
                .skip-link:focus {
                    top: 0;
                }
                
                button:focus,
                a:focus,
                input:focus {
                    outline: 2px solid var(--color-primary);
                    outline-offset: 2px;
                }
            `;
            document.head.appendChild(style);
        });
    </script>
    
    <!-- Load test modules -->
    <script src="contrast-checker.js"></script>
    <script src="keyboard-navigation-test.js"></script>
    <script src="visual-accessibility-test.js"></script>
</body>
</html>