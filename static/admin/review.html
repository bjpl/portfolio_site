<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Review & Revision Tool - Hugo</title>
    <script src="auth.js"></script>
    <script src="admin-nav.js"></script>
    <script src="toast.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5b21b6;
            --primary-dark: #4c1d95;
            --secondary: #2563eb;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --info: #0891b2;
            --dark: #111827;
            --gray: #6b7280;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);

            /* Status colors */
            --status-draft: #fbbf24;
            --status-review: #3b82f6;
            --status-approved: #10b981;
            --status-published: #8b5cf6;
            --status-archived: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #5b21b6 0%, #1e40af 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .app-layout {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            height: 100vh;
            gap: 1px;
            background: var(--gray);
        }

        /* Left Panel - Content Browser */
        .content-browser {
            background: var(--white);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .browser-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
        }

        .browser-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .browser-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .search-box {
            padding: 1rem;
            border-bottom: 1px solid var(--light);
        }

        .search-input {
            width: 100%;
            padding: 0.625rem;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91, 33, 182, 0.1);
        }

        .filter-section {
            padding: 1rem;
            border-bottom: 1px solid var(--light);
        }

        .filter-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-chip {
            padding: 0.375rem 0.75rem;
            background: var(--light);
            border-radius: 9999px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .filter-chip:hover {
            background: var(--primary);
            color: var(--white);
        }

        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary-dark);
        }

        .content-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .content-item {
            padding: 1rem;
            background: var(--white);
            border: 2px solid var(--light);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .content-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .content-item.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary-dark);
        }

        .content-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .content-item-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .content-item-status {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-draft {
            background: var(--status-draft);
            color: var(--white);
        }

        .status-review {
            background: var(--status-review);
            color: var(--white);
        }

        .status-approved {
            background: var(--status-approved);
            color: var(--white);
        }

        .status-published {
            background: var(--status-published);
            color: var(--white);
        }

        .status-archived {
            background: var(--status-archived);
            color: var(--white);
        }

        .content-item-meta {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .content-item.active .content-item-meta {
            opacity: 0.9;
        }

        .content-item-path {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            font-family: 'Courier New', monospace;
            opacity: 0.6;
        }

        /* Center Panel - Editor */
        .editor-panel {
            background: var(--white);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-toolbar {
            padding: 1rem 1.5rem;
            background: var(--light);
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toolbar-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toolbar-btn {
            padding: 0.5rem 0.75rem;
            background: var(--white);
            border: 1px solid var(--gray);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.875rem;
        }

        .toolbar-btn:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .toolbar-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: var(--gray);
            margin: 0 0.5rem;
        }

        .editor-tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--gray);
        }

        .editor-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.3s;
        }

        .editor-tab:hover {
            color: var(--dark);
            background: var(--white);
        }

        .editor-tab.active {
            color: var(--primary);
            background: var(--white);
            border-bottom-color: var(--primary);
        }

        .editor-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .editor-section {
            margin-bottom: 2rem;
        }

        .editor-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .editor-input,
        .editor-textarea,
        .editor-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: var(--white);
        }

        .editor-input:focus,
        .editor-textarea:focus,
        .editor-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91, 33, 182, 0.1);
        }

        .editor-textarea {
            min-height: 200px;
            resize: vertical;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .markdown-editor {
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .markdown-toolbar {
            padding: 0.5rem;
            background: var(--light);
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .markdown-btn {
            padding: 0.375rem 0.5rem;
            background: var(--white);
            border: 1px solid var(--gray);
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }

        .markdown-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        .markdown-textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .preview-content {
            padding: 1rem;
            min-height: 400px;
            background: var(--white);
            border: 2px solid var(--light);
            border-radius: 0.5rem;
        }

        .diff-viewer {
            background: var(--dark);
            color: var(--white);
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }

        .diff-line {
            padding: 0.25rem 0.5rem;
            margin: 0.125rem 0;
        }

        .diff-add {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .diff-remove {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .diff-context {
            color: #9ca3af;
        }

        /* Right Panel - Revision History */
        .revision-panel {
            background: var(--white);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .revision-header {
            padding: 1.5rem;
            background: var(--light);
            border-bottom: 2px solid var(--light);
        }

        .revision-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .revision-subtitle {
            font-size: 0.875rem;
            color: var(--gray);
        }

        .revision-stats {
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            border-bottom: 1px solid var(--light);
        }

        .revision-stat {
            text-align: center;
        }

        .revision-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .revision-stat-label {
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
        }

        .revision-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .revision-item {
            padding: 1rem;
            background: var(--light);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .revision-item:hover {
            background: var(--primary);
            color: var(--white);
            transform: translateX(-5px);
        }

        .revision-item.active {
            background: var(--primary);
            color: var(--white);
        }

        .revision-number {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            opacity: 0.7;
        }

        .revision-date {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .revision-author {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .revision-changes {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .revision-actions {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .revision-btn {
            padding: 0.25rem 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .revision-item:not(:hover) .revision-btn {
            background: var(--white);
            border-color: var(--gray);
            color: var(--dark);
        }

        .revision-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Quality Check Panel */
        .quality-panel {
            background: var(--light);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .quality-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .quality-title {
            font-weight: 600;
            color: var(--dark);
        }

        .quality-score {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success);
        }

        .quality-checks {
            display: grid;
            gap: 0.75rem;
        }

        .quality-check {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--white);
            border-radius: 0.5rem;
        }

        .quality-check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        .quality-check-icon.pass {
            background: var(--success);
            color: var(--white);
        }

        .quality-check-icon.warning {
            background: var(--warning);
            color: var(--white);
        }

        .quality-check-icon.fail {
            background: var(--danger);
            color: var(--white);
        }

        .quality-check-text {
            flex: 1;
            font-size: 0.875rem;
        }

        .quality-check-action {
            padding: 0.25rem 0.5rem;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quality-check-action:hover {
            background: var(--primary-dark);
        }

        /* Comments Section */
        .comments-section {
            background: var(--light);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .comments-title {
            font-weight: 600;
            color: var(--dark);
        }

        .comment-count {
            padding: 0.25rem 0.5rem;
            background: var(--primary);
            color: var(--white);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .comment-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .comment-item {
            padding: 1rem;
            background: var(--white);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .comment-date {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .comment-text {
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .comment-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--white);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: var(--white);
            resize: none;
        }

        /* Action Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray);
            color: var(--white);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        /* Floating Action Bar */
        .action-bar {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            padding: 1rem 2rem;
            border-radius: 9999px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 100;
        }

        .action-bar-text {
            color: var(--white);
            font-size: 0.875rem;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--success);
            color: var(--white);
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Back to Dashboard Link */
        .back-link {
            position: fixed;
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            background: var(--white);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--primary);
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
            transition: all 0.3s;
        }

        .back-link:hover {
            transform: translateX(-5px);
            box-shadow: var(--shadow-lg);
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .app-layout {
                grid-template-columns: 250px 1fr 300px;
            }
        }

        @media (max-width: 1024px) {
            .app-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }

            .content-browser,
            .revision-panel {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- Back to Dashboard -->
    <a href="dashboard.html" class="back-link">
        <span>←</span>
        Back to Dashboard
    </a>

    <div class="app-layout">
        <!-- Left Panel - Content Browser -->
        <aside class="content-browser">
            <div class="content-list" id="contentList">
                <!-- Content items will be loaded here dynamically -->
            </div>
        </aside>

        <!-- Center Panel - Editor -->
        <main class="editor-panel main-content" id="main-content">
            <div class="editor-toolbar">
                <div class="toolbar-section">
                    <button class="toolbar-btn" onclick="saveContent()">
                        <span>💾</span>
                        Save
                    </button>
                    <button class="toolbar-btn" onclick="createRevision()">
                        <span>🔄</span>
                        Create Revision
                    </button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="runQualityCheck()">
                        <span>✓</span>
                        Quality Check
                    </button>
                    <button class="toolbar-btn" onclick="compareVersions()">
                        <span>🔀</span>
                        Compare
                    </button>
                </div>
                <div class="toolbar-section">
                    <select class="editor-select" style="width: auto;" id="statusSelect"
                        onchange="changeStatus(this.value)">
                        <option value="draft">Draft</option>
                        <option value="review" selected>In Review</option>
                        <option value="approved">Approved</option>
                        <option value="published">Published</option>
                        <option value="archived">Archived</option>
                    </select>
                    <button class="btn btn-success btn-sm" onclick="approveContent()">Approve</button>
                    <button class="btn btn-primary btn-sm" onclick="publishContent()">Publish</button>
                </div>
            </div>

            <div class="editor-tabs">
                <button class="editor-tab active" onclick="switchTab('edit')">Edit</button>
                <button class="editor-tab" onclick="switchTab('preview')">Preview</button>
                <button class="editor-tab" onclick="switchTab('diff')">Changes</button>
                <button class="editor-tab" onclick="switchTab('metadata')">Metadata</button>
            </div>

            <div class="editor-content" id="editTab">
                <div class="editor-section">
                    <label class="editor-label">Title</label>
                    <input type="text" class="editor-input" id="titleInput">
                </div>

                <div class="editor-section">
                    <label class="editor-label">Front Matter</label>
                    <textarea class="editor-textarea" id="frontMatterInput"></textarea>
                </div>

                <div class="editor-section">
                    <label class="editor-label">Content</label>
                    <div class="markdown-editor">
                        <div class="markdown-toolbar">
                            <button class="markdown-btn" onclick="insertMarkdown('**', '**')">B</button>
                            <button class="markdown-btn" onclick="insertMarkdown('*', '*')">I</button>
                            <button class="markdown-btn" onclick="insertMarkdown('## ')">H2</button>
                            <button class="markdown-btn" onclick="insertMarkdown('### ')">H3</button>
                            <button class="markdown-btn" onclick="insertMarkdown('[', '](url)')">Link</button>
                            <button class="markdown-btn" onclick="insertMarkdown('![', '](url)')">Image</button>
                            <button class="markdown-btn" onclick="insertMarkdown('```\n', '\n```')">Code</button>
                            <button class="markdown-btn" onclick="insertMarkdown('- ')">List</button>
                            <button class="markdown-btn" onclick="insertMarkdown('> ')">Quote</button>
                        </div>
                        <textarea class="markdown-textarea" id="contentInput"></textarea>
                    </div>
                </div>

                <!-- Quality Check Panel -->
                <div class="quality-panel">
                    <div class="quality-header">
                        <span class="quality-title">Content Quality Score</span>
                        <span class="quality-score" id="qualityScore">--/100</span>
                    </div>
                    <div class="quality-checks" id="qualityChecks">
                        <!-- Quality checks will be loaded here -->
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="comments-section">
                    <div class="comments-header">
                        <span class="comments-title">Review Comments</span>
                        <span class="comment-count" id="commentCount">0</span>
                    </div>
                    <div class="comment-list" id="commentList">
                        <!-- Comments will be loaded here -->
                    </div>
                    <textarea class="comment-input" id="newComment" placeholder="Add a comment..." rows="3"></textarea>
                    <button class="btn btn-primary btn-sm" style="margin-top: 0.5rem;" onclick="postComment()">Post
                        Comment</button>
                </div>
            </div>

            <div class="editor-content" id="previewTab" style="display: none;">
                <div class="preview-content" id="previewContent">
                    <!-- Rendered markdown preview will appear here -->
                </div>
            </div>

            <div class="editor-content" id="diffTab" style="display: none;">
                <div class="diff-viewer" id="diffViewer">
                    <!-- Diff content will appear here -->
                </div>
            </div>

            <div class="editor-content" id="metadataTab" style="display: none;">
                <div class="editor-section">
                    <label class="editor-label">Section</label>
                    <select class="editor-select" id="sectionSelect">
                        <option value="learn/built">learn/built</option>
                        <option value="learn/found">learn/found</option>
                        <option value="learn/strategies">learn/strategies</option>
                        <option value="make/sounds">make/sounds</option>
                        <option value="make/visuals">make/visuals</option>
                        <option value="make/words">make/words</option>
                        <option value="meet/me">meet/me</option>
                        <option value="meet/work">meet/work</option>
                        <option value="think/positions">think/positions</option>
                        <option value="think/links">think/links</option>
                    </select>
                </div>

                <div class="editor-section">
                    <label class="editor-label">Tags</label>
                    <input type="text" class="editor-input" id="tagsInput">
                </div>

                <div class="editor-section">
                    <label class="editor-label">Categories</label>
                    <input type="text" class="editor-input" id="categoriesInput">
                </div>

                <div class="editor-section">
                    <label class="editor-label">Author</label>
                    <input type="text" class="editor-input" id="authorInput">
                </div>

                <div class="editor-section">
                    <label class="editor-label">Reading Time</label>
                    <input type="text" class="editor-input" id="readingTimeInput" readonly>
                </div>
            </div>
        </main>

        <!-- Right Panel - Revision History -->
        <aside class="revision-panel">
            <div class="revision-header">
                <h2 class="revision-title">Revision History</h2>
                <p class="revision-subtitle" id="revisionSummary">Loading revisions...</p>
            </div>

            <div class="revision-stats">
                <div class="revision-stat">
                    <div class="revision-stat-value" id="totalRevisions">0</div>
                    <div class="revision-stat-label">Revisions</div>
                </div>
                <div class="revision-stat">
                    <div class="revision-stat-value" id="totalAuthors">0</div>
                    <div class="revision-stat-label">Authors</div>
                </div>
                <div class="revision-stat">
                    <div class="revision-stat-value" id="contentAge">0d</div>
                    <div class="revision-stat-label">Age</div>
                </div>
                <div class="revision-stat">
                    <div class="revision-stat-value" id="netChanges">+0</div>
                    <div class="revision-stat-label">Net Changes</div>
                </div>
            </div>

            <div class="revision-list" id="revisionList">
                <!-- Revisions will be loaded here -->
            </div>
        </aside>
    </div>

    <!-- Floating Action Bar -->
    <div class="action-bar" id="actionBar" style="display: none;">
        <span class="action-bar-text">Unsaved changes</span>
        <button class="btn btn-sm btn-primary" onclick="saveContent()">Save</button>
        <button class="btn btn-sm btn-secondary" onclick="discardChanges()">Discard</button>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Load API Client -->
    <script src="/admin/api-client.js"></script>

    <script>
        // Global state
        let currentContent = null;
        let originalContent = null;
        let unsavedChanges = false;
        let currentTab = 'edit';
        let currentContentId = null;
        let activeFilters = {
            status: 'review',
            section: null,
            search: ''
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadContentList();
            setupAutoSave();
            trackChanges();
            updateContentSummary();

            // Listen for real-time updates
            window.addEventListener('hugo-update', (event) => {
                handleRealtimeUpdate(event.detail);
            });
        });

        // Load content list
        async function loadContentList() {
            try {
                const filters = {
                    status: activeFilters.status,
                    section: activeFilters.section,
                    search: activeFilters.search
                };

                const content = await hugoAPI.getContentList(filters);
                renderContentList(content);
                updateFilterCounts(content);
            } catch (error) {
                // Use simulated data if API fails
                renderContentList(getSimulatedContent());
            }
        }

        // Render content list
        function renderContentList(items) {
            const container = document.getElementById('contentList');

            if (!items || items.length === 0) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: #6b7280;">No content found</div>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="content-item ${item.id === currentContentId ? 'active' : ''}" onclick="loadContent('${item.id}')">
                    <div class="content-item-header">
                        <span class="content-item-title">${item.title}</span>
                        <span class="content-item-status status-${item.status}">${item.status}</span>
                    </div>
                    <div class="content-item-meta">Modified ${item.modified} • ${item.wordCount} words</div>
                    <div class="content-item-path">${item.path}</div>
                </div>
            `).join('');
        }

        // Load specific content
        async function loadContent(id) {
            if (unsavedChanges && !confirm('You have unsaved changes. Continue?')) {
                return;
            }

            currentContentId = id;

            // Update UI
            document.querySelectorAll('.content-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            try {
                const content = await hugoAPI.getContent(id);
                displayContent(content);
            } catch (error) {
                // Use simulated content
                displayContent(getSimulatedContentById(id));
            }

            // Reset state
            originalContent = document.getElementById('contentInput').value;
            unsavedChanges = false;
            updateActionBar();

            showToast('Content loaded successfully');
        }

        // Display content in editor
        function displayContent(content) {
            document.getElementById('titleInput').value = content.title || '';
            document.getElementById('frontMatterInput').value = content.frontMatter || '';
            document.getElementById('contentInput').value = content.content || '';
            document.getElementById('statusSelect').value = content.status || 'draft';

            // Update metadata
            if (content.metadata) {
                document.getElementById('sectionSelect').value = content.metadata.section || '';
                document.getElementById('tagsInput').value = (content.metadata.tags || []).join(', ');
                document.getElementById('categoriesInput').value = (content.metadata.categories || []).join(', ');
                document.getElementById('authorInput').value = content.metadata.author || '';
                document.getElementById('readingTimeInput').value = content.metadata.readingTime || '';
            }

            // Load revisions
            loadRevisions(content.id);

            // Run quality check
            runQualityCheck();
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.editor-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelectorAll('.editor-content').forEach(c => {
                c.style.display = 'none';
            });

            event.currentTarget.classList.add('active');
            document.getElementById(tab + 'Tab').style.display = 'block';
            currentTab = tab;

            if (tab === 'preview') {
                renderPreview();
            } else if (tab === 'diff') {
                loadDiff();
            }
        }

        // Track changes
        function trackChanges() {
            const inputs = ['titleInput', 'frontMatterInput', 'contentInput'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        unsavedChanges = true;
                        updateActionBar();
                    });
                }
            });
        }

        // Update action bar
        function updateActionBar() {
            const actionBar = document.getElementById('actionBar');
            actionBar.style.display = unsavedChanges ? 'flex' : 'none';
        }

        // Save content
        async function saveContent() {
            if (!currentContentId) {
                showToast('No content selected', 'error');
                return;
            }

            const data = {
                title: document.getElementById('titleInput').value,
                frontMatter: document.getElementById('frontMatterInput').value,
                content: document.getElementById('contentInput').value,
                status: document.getElementById('statusSelect').value,
                metadata: {
                    section: document.getElementById('sectionSelect').value,
                    tags: document.getElementById('tagsInput').value.split(',').map(t => t.trim()),
                    categories: document.getElementById('categoriesInput').value.split(',').map(c => c.trim()),
                    author: document.getElementById('authorInput').value
                }
            };

            try {
                await hugoAPI.saveContent(currentContentId, data);
                originalContent = document.getElementById('contentInput').value;
                unsavedChanges = false;
                updateActionBar();
                showToast('Content saved successfully', 'success');
                loadContentList(); // Refresh list
            } catch (error) {
                showToast('Failed to save content', 'error');
            }
        }

        // Quality check
        async function runQualityCheck() {
            const content = document.getElementById('contentInput').value;
            const title = document.getElementById('titleInput').value;

            try {
                const result = await hugoAPI.checkQuality({ content, title });
                displayQualityResults(result);
            } catch (error) {
                // Use simulated quality check
                displayQualityResults(performQualityCheck(content, title));
            }
        }

        // Display quality check results
        function displayQualityResults(result) {
            document.getElementById('qualityScore').textContent = `${result.score}/100`;

            const checksContainer = document.getElementById('qualityChecks');
            checksContainer.innerHTML = result.checks.map(check => `
                <div class="quality-check">
                    <span class="quality-check-icon ${check.status}">${check.status === 'pass' ? '✓' :
                    check.status === 'warning' ? '!' : '✗'
                }</span>
                    <span class="quality-check-text">${check.message}</span>
                    ${check.fixable ? `<button class="quality-check-action" onclick="fixIssue('${check.type}')">Fix</button>` : ''}
                </div>
            `).join('');
        }

        // Perform comprehensive quality check
        function performQualityCheck(content, title) {
            const wordCount = content.split(/\s+/).length;
            const hasTitle = title && title.length > 0;
            const titleLength = title ? title.length : 0;
            const hasMetaDescription = content.includes('description:');
            const hasKeywords = content.includes('keywords:') || content.includes('tags:');
            const hasFrontMatter = content.startsWith('---');
            
            // Check for images and alt text
            const imgRegex = /!\[([^\]]*)\]\([^)]+\)/g;
            const images = content.match(imgRegex) || [];
            const missingAltText = images.filter(img => img.startsWith('![]')).length;
            
            // Check for broken links
            const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
            const links = content.match(linkRegex) || [];
            
            // Check for code blocks
            const codeBlocks = (content.match(/```/g) || []).length / 2;
            
            // Calculate score
            let score = 100;
            if (!hasTitle) score -= 20;
            if (!hasMetaDescription) score -= 10;
            if (wordCount < 300) score -= 15;
            if (missingAltText > 0) score -= 5 * missingAltText;
            if (!hasFrontMatter) score -= 10;
            if (titleLength > 60) score -= 5;
            
            return {
                score: Math.max(0, score),
                checks: [
                    { 
                        status: hasTitle ? 'pass' : 'fail', 
                        message: hasTitle ? 'Title present' : 'Missing title', 
                        type: 'title' 
                    },
                    { 
                        status: titleLength <= 60 ? 'pass' : 'warning', 
                        message: `Title length: ${titleLength} characters ${titleLength > 60 ? '(recommended: < 60)' : ''}`, 
                        type: 'title-length' 
                    },
                    { 
                        status: hasMetaDescription ? 'pass' : 'warning', 
                        message: hasMetaDescription ? 'SEO meta description present' : 'Missing meta description', 
                        type: 'meta', 
                        fixable: true 
                    },
                    { 
                        status: hasKeywords ? 'pass' : 'info', 
                        message: hasKeywords ? 'Keywords/tags present' : 'No keywords or tags defined', 
                        type: 'keywords', 
                        fixable: true 
                    },
                    { 
                        status: wordCount > 300 ? 'pass' : 'warning', 
                        message: `Word count: ${wordCount} words ${wordCount < 300 ? '(recommended: 300+)' : ''}`, 
                        type: 'wordcount' 
                    },
                    { 
                        status: hasFrontMatter ? 'pass' : 'fail', 
                        message: hasFrontMatter ? 'Valid front matter' : 'Missing front matter', 
                        type: 'frontmatter', 
                        fixable: true 
                    },
                    { 
                        status: missingAltText === 0 ? 'pass' : 'warning', 
                        message: missingAltText === 0 ? 'All images have alt text' : `${missingAltText} images missing alt text`, 
                        type: 'alt-text', 
                        fixable: true 
                    },
                    { 
                        status: 'info', 
                        message: `${links.length} links found`, 
                        type: 'links' 
                    },
                    { 
                        status: codeBlocks > 0 ? 'info' : 'info', 
                        message: `${codeBlocks} code blocks`, 
                        type: 'code' 
                    }
                ]
            };
        }

        // Filter functions
        function filterByStatus(status) {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            activeFilters.status = status;
            loadContentList();
        }

        function filterBySection(section) {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            activeFilters.section = section;
            loadContentList();
        }

        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
            activeFilters.search = e.target.value;
            loadContentList();
        });

        // Markdown helpers
        function insertMarkdown(before, after = '') {
            const textarea = document.getElementById('contentInput');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            const selected = text.substring(start, end);

            textarea.value = text.substring(0, start) + before + selected + after + text.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + before.length, start + before.length + selected.length);

            // Mark as changed
            unsavedChanges = true;
            updateActionBar();
        }

        // Render preview
        function renderPreview() {
            const content = document.getElementById('contentInput').value;
            // Simple markdown to HTML conversion (in production, use a proper markdown parser)
            let html = content
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*(.+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+)\*/g, '<em>$1</em>')
                .replace(/```(.+?)```/gs, '<pre><code>$1</code></pre>')
                .replace(/`(.+?)`/g, '<code>$1</code>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');

            html = '<p>' + html + '</p>';
            document.getElementById('previewContent').innerHTML = html;
        }

        // Auto-save
        function setupAutoSave() {
            setInterval(() => {
                if (unsavedChanges && currentContentId) {
                    // Auto-save logic
                    console.log('Auto-saving...');
                }
            }, 30000); // Every 30 seconds
        }

        // Handle real-time updates
        function handleRealtimeUpdate(data) {
            if (data.type === 'content-changed' && data.contentId !== currentContentId) {
                loadContentList();
                showToast('Content list updated', 'info');
            }
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type === 'error' ? 'error' : type === 'warning' ? 'warning' : ''}`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Simulated data functions
        function getSimulatedContent() {
            return [
                {
                    id: '1',
                    title: 'React Hooks Deep Dive',
                    status: 'review',
                    modified: '2 hours ago',
                    wordCount: 1234,
                    path: 'learn/built/react-hooks-deep-dive.md'
                },
                {
                    id: '2',
                    title: 'Portfolio Redesign Case Study',
                    status: 'draft',
                    modified: 'yesterday',
                    wordCount: 892,
                    path: 'meet/work/portfolio-redesign.md'
                },
                {
                    id: '3',
                    title: 'Sustainable Web Design',
                    status: 'approved',
                    modified: '3 days ago',
                    wordCount: 2156,
                    path: 'think/positions/sustainable-web.md'
                }
            ];
        }

        function getSimulatedContentById(id) {
            return {
                id: id,
                title: 'React Hooks Deep Dive',
                frontMatter: `---
title: "React Hooks Deep Dive"
date: 2024-01-15T10:00:00Z
draft: false
description: "A comprehensive guide to React Hooks"
tags: ["react", "hooks", "javascript"]
---`,
                content: `## Introduction

React Hooks revolutionized how we write React components...`,
                status: 'review',
                metadata: {
                    section: 'learn/built',
                    tags: ['react', 'hooks', 'javascript'],
                    categories: ['development'],
                    author: 'Content Team',
                    readingTime: '6 minutes'
                }
            };
        }

        function updateContentSummary() {
            // Update summary text
            const total = 132;
            const pending = 5;
            document.getElementById('contentSummary').textContent = `${total} items • ${pending} pending review`;
        }

        function updateFilterCounts(content) {
            // Update filter counts
            // This would be calculated from actual content
            document.getElementById('draftCount').textContent = '23';
            document.getElementById('reviewCount').textContent = '5';
            document.getElementById('approvedCount').textContent = '12';
            document.getElementById('publishedCount').textContent = '89';
            document.getElementById('archivedCount').textContent = '3';
        }

        // Additional placeholder functions
        function createRevision() {
            if (unsavedChanges && !confirm('Save changes before creating revision?')) {
                return;
            }
            showToast('Revision created successfully', 'success');
        }

        function compareVersions() {
            switchTab('diff');
        }

        function loadDiff() {
            // Load diff content
            document.getElementById('diffViewer').innerHTML = `
                <div class="diff-context">@@ -1,10 +1,12 @@</div>
                <div class="diff-context">## Introduction</div>
                <div class="diff-remove">- React Hooks changed how we write React components.</div>
                <div class="diff-add">+ React Hooks revolutionized how we write React components.</div>
            `;
        }

        function changeStatus(status) {
            showToast(`Status changed to: ${status}`, 'info');
        }

        function approveContent() {
            changeStatus('approved');
            showToast('Content approved', 'success');
        }

        function publishContent() {
            if (confirm('Publish this content?')) {
                changeStatus('published');
                showToast('Content published', 'success');
            }
        }

        function fixIssue(type) {
            showToast(`Fixing ${type} issue...`, 'info');
        }

        function discardChanges() {
            if (confirm('Discard all unsaved changes?')) {
                loadContent(currentContentId);
            }
        }

        function loadRevisions(contentId) {
            // Load revision history
            document.getElementById('totalRevisions').textContent = '12';
            document.getElementById('totalAuthors').textContent = '3';
            document.getElementById('contentAge').textContent = '7d';
            document.getElementById('netChanges').textContent = '+428';
            document.getElementById('revisionSummary').textContent = '12 total revisions';
        }

        function postComment() {
            const comment = document.getElementById('newComment').value;
            if (comment.trim()) {
                showToast('Comment posted', 'success');
                document.getElementById('newComment').value = '';
            }
        }
    </script>
</body>

</html>="browser-header">
<h1 class="browser-title">
    <span>📝</span>
    Content Review
</h1>
<p class="browser-subtitle" id="contentSummary">Loading content...</p>
</div>

<div class="search-box">
    <input type="text" class="search-input" placeholder="Search content..." id="searchInput">
</div>

<div class="filter-section">
    <div class="filter-title">Status</div>
    <div class="filter-chips">
        <div class="filter-chip" onclick="filterByStatus('draft')">Draft (<span id="draftCount">0</span>)</div>
        <div class="filter-chip active" onclick="filterByStatus('review')">Review (<span id="reviewCount">0</span>)
        </div>
        <div class="filter-chip" onclick="filterByStatus('approved')">Approved (<span id="approvedCount">0</span>)</div>
        <div class="filter-chip" onclick="filterByStatus('published')">Published (<span id="publishedCount">0</span>)
        </div>
        <div class="filter-chip" onclick="filterByStatus('archived')">Archived (<span id="archivedCount">0</span>)</div>
    </div>
</div>

<div class="filter-section">
    <div class="filter-title">Section</div>
    <div class="filter-chips">
        <div class="filter-chip" onclick="filterBySection('learn')">Learn</div>
        <div class="filter-chip" onclick="filterBySection('make')">Make</div>
        <div class="filter-chip" onclick="filterBySection('meet')">Meet</div>
        <div class="filter-chip" onclick="filterBySection('think')">Think</div>
    </div>
</div>

<div class