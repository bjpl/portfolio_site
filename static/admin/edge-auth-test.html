<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Edge Authentication Testing - Portfolio Admin</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n            background: #f5f7fa;\n            padding: 20px;\n            line-height: 1.6;\n        }\n\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n\n        h1 {\n            color: #333;\n            margin-bottom: 20px;\n            text-align: center;\n        }\n\n        .test-section {\n            background: white;\n            border-radius: 8px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            margin-bottom: 20px;\n            padding: 20px;\n        }\n\n        .test-section h2 {\n            color: #444;\n            margin-bottom: 15px;\n            border-bottom: 2px solid #eee;\n            padding-bottom: 5px;\n        }\n\n        .test-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 20px;\n        }\n\n        .test-card {\n            border: 2px solid #e1e5e9;\n            border-radius: 6px;\n            padding: 15px;\n        }\n\n        .test-card.success {\n            border-color: #28a745;\n            background: #f8fff9;\n        }\n\n        .test-card.error {\n            border-color: #dc3545;\n            background: #fff8f8;\n        }\n\n        .test-card.pending {\n            border-color: #ffc107;\n            background: #fffdf5;\n        }\n\n        .test-card h3 {\n            margin-bottom: 10px;\n            font-size: 16px;\n        }\n\n        .test-result {\n            background: #f8f9fa;\n            border-radius: 4px;\n            padding: 10px;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            max-height: 200px;\n            overflow-y: auto;\n            white-space: pre-wrap;\n        }\n\n        .test-button {\n            background: #007bff;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            margin: 5px 5px 10px 0;\n        }\n\n        .test-button:hover {\n            background: #0056b3;\n        }\n\n        .test-button:disabled {\n            background: #6c757d;\n            cursor: not-allowed;\n        }\n\n        .status-indicator {\n            display: inline-block;\n            width: 12px;\n            height: 12px;\n            border-radius: 50%;\n            margin-right: 8px;\n        }\n\n        .status-indicator.success {\n            background: #28a745;\n        }\n\n        .status-indicator.error {\n            background: #dc3545;\n        }\n\n        .status-indicator.pending {\n            background: #ffc107;\n        }\n\n        .auth-controls {\n            background: #e9ecef;\n            padding: 15px;\n            border-radius: 6px;\n            margin-bottom: 20px;\n        }\n\n        .auth-controls input {\n            margin: 0 10px 10px 0;\n            padding: 6px 12px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n        }\n\n        .auth-status {\n            padding: 10px;\n            border-radius: 6px;\n            margin-bottom: 10px;\n            font-weight: bold;\n        }\n\n        .auth-status.authenticated {\n            background: #d4edda;\n            color: #155724;\n        }\n\n        .auth-status.unauthenticated {\n            background: #f8d7da;\n            color: #721c24;\n        }\n\n        pre {\n            background: #f8f9fa;\n            padding: 10px;\n            border-radius: 4px;\n            overflow-x: auto;\n            font-size: 12px;\n        }\n\n        .loading {\n            display: inline-block;\n            width: 12px;\n            height: 12px;\n            border: 2px solid #ccc;\n            border-top: 2px solid #007bff;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        .edge-badge {\n            display: inline-block;\n            background: linear-gradient(45deg, #00d4ff, #0099cc);\n            color: white;\n            padding: 4px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            font-weight: bold;\n            margin-left: 10px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Edge Authentication Testing <span class=\"edge-badge\">ðŸš€ Netlify Edge Functions</span></h1>\n        \n        <div class=\"test-section\">\n            <h2>Authentication Status</h2>\n            <div id=\"auth-status\" class=\"auth-status unauthenticated\">\n                Not Authenticated\n            </div>\n            \n            <div class=\"auth-controls\">\n                <input type=\"text\" id=\"test-username\" placeholder=\"Username\" value=\"admin\">\n                <input type=\"password\" id=\"test-password\" placeholder=\"Password\" value=\"admin123\">\n                <button class=\"test-button\" onclick=\"testLogin()\">Test Login</button>\n                <button class=\"test-button\" onclick=\"testVerify()\">Verify Token</button>\n                <button class=\"test-button\" onclick=\"testLogout()\">Test Logout</button>\n            </div>\n        </div>\n\n        <div class=\"test-section\">\n            <h2>Edge Function Tests</h2>\n            <div class=\"test-grid\">\n                <div id=\"test-runtime\" class=\"test-card pending\">\n                    <h3><span class=\"status-indicator pending\"></span>Runtime Test</h3>\n                    <button class=\"test-button\" onclick=\"testEdgeRuntime()\">Test Deno Runtime</button>\n                    <div class=\"test-result\" id=\"runtime-result\">Click 'Test Deno Runtime' to run...</div>\n                </div>\n\n                <div id=\"test-crypto\" class=\"test-card pending\">\n                    <h3><span class=\"status-indicator pending\"></span>Web Crypto API</h3>\n                    <button class=\"test-button\" onclick=\"testWebCrypto()\">Test Crypto</button>\n                    <div class=\"test-result\" id=\"crypto-result\">Click 'Test Crypto' to run...</div>\n                </div>\n\n                <div id=\"test-jwt\" class=\"test-card pending\">\n                    <h3><span class=\"status-indicator pending\"></span>JWT Operations</h3>\n                    <button class=\"test-button\" onclick=\"testJWTOperations()\">Test JWT</button>\n                    <div class=\"test-result\" id=\"jwt-result\">Click 'Test JWT' to run...</div>\n                </div>\n\n                <div id=\"test-auth-flow\" class=\"test-card pending\">\n                    <h3><span class=\"status-indicator pending\"></span>Authentication Flow</h3>\n                    <button class=\"test-button\" onclick=\"testFullAuthFlow()\">Test Full Flow</button>\n                    <div class=\"test-result\" id=\"auth-flow-result\">Click 'Test Full Flow' to run...</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"test-section\">\n            <h2>Protected Routes Test</h2>\n            <div class=\"test-grid\">\n                <div id=\"test-protected\" class=\"test-card pending\">\n                    <h3><span class=\"status-indicator pending\"></span>Protected Route Access</h3>\n                    <button class=\"test-button\" onclick=\"testProtectedRoute('/api/admin/test')\">Test /api/admin/*</button>\n                    <button class=\"test-button\" onclick=\"testProtectedRoute('/admin/dashboard.html')\">Test /admin/*</button>\n                    <div class=\"test-result\" id=\"protected-result\">Click buttons to test protected routes...</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"/js/edge-auth-client.js\"></script>\n    <script>\n        let testResults = {};\n\n        // Update auth status display\n        function updateAuthStatus() {\n            const authStatus = document.getElementById('auth-status');\n            const isAuth = window.EdgeAuth.isAuthenticated();\n            const user = window.EdgeAuth.getUser();\n            \n            if (isAuth && user) {\n                authStatus.className = 'auth-status authenticated';\n                authStatus.textContent = `Authenticated as: ${user.username} (${user.role})`;\n            } else {\n                authStatus.className = 'auth-status unauthenticated';\n                authStatus.textContent = 'Not Authenticated';\n            }\n        }\n\n        // Test Deno runtime\n        async function testEdgeRuntime() {\n            updateTestCard('test-runtime', 'pending', 'Testing Deno runtime...');\n            \n            try {\n                const response = await fetch('/api/test-edge');\n                const data = await response.json();\n                \n                if (data.success) {\n                    updateTestCard('test-runtime', 'success', JSON.stringify(data, null, 2));\n                } else {\n                    updateTestCard('test-runtime', 'error', `Error: ${data.error}`);\n                }\n            } catch (error) {\n                updateTestCard('test-runtime', 'error', `Error: ${error.message}`);\n            }\n        }\n\n        // Test Web Crypto API\n        async function testWebCrypto() {\n            updateTestCard('test-crypto', 'pending', 'Testing Web Crypto API...');\n            \n            try {\n                // Test basic crypto operations\n                const encoder = new TextEncoder();\n                const data = encoder.encode('test-data');\n                \n                const key = await crypto.subtle.generateKey(\n                    { name: 'HMAC', hash: 'SHA-256' },\n                    true,\n                    ['sign', 'verify']\n                );\n                \n                const signature = await crypto.subtle.sign('HMAC', key, data);\n                const isValid = await crypto.subtle.verify('HMAC', key, signature, data);\n                \n                const result = {\n                    cryptoAvailable: typeof crypto !== 'undefined',\n                    subtleCrypto: typeof crypto.subtle !== 'undefined',\n                    keyGeneration: !!key,\n                    signing: !!signature,\n                    verification: isValid\n                };\n                \n                updateTestCard('test-crypto', 'success', JSON.stringify(result, null, 2));\n            } catch (error) {\n                updateTestCard('test-crypto', 'error', `Error: ${error.message}`);\n            }\n        }\n\n        // Test JWT operations\n        async function testJWTOperations() {\n            updateTestCard('test-jwt', 'pending', 'Testing JWT operations...');\n            \n            try {\n                // Test login to get JWT\n                const loginResponse = await fetch('/api/auth/login', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ username: 'admin', password: 'admin123' })\n                });\n                \n                const loginData = await loginResponse.json();\n                \n                if (loginData.success) {\n                    // Test token verification\n                    const verifyResponse = await fetch('/api/auth/verify', {\n                        headers: { 'Authorization': `Bearer ${loginData.token}` }\n                    });\n                    \n                    const verifyData = await verifyResponse.json();\n                    \n                    const result = {\n                        login: loginData.success,\n                        tokenReceived: !!loginData.token,\n                        tokenValid: verifyData.valid,\n                        userInfo: verifyData.user\n                    };\n                    \n                    updateTestCard('test-jwt', 'success', JSON.stringify(result, null, 2));\n                } else {\n                    updateTestCard('test-jwt', 'error', `Login failed: ${loginData.error}`);\n                }\n            } catch (error) {\n                updateTestCard('test-jwt', 'error', `Error: ${error.message}`);\n            }\n        }\n\n        // Test full authentication flow\n        async function testFullAuthFlow() {\n            updateTestCard('test-auth-flow', 'pending', 'Testing full authentication flow...');\n            \n            const steps = [];\n            \n            try {\n                // Step 1: Login\n                steps.push('1. Attempting login...');\n                const result = await window.EdgeAuth.login('admin', 'admin123');\n                steps.push(`2. Login result: ${result.success ? 'SUCCESS' : 'FAILED'}`);\n                \n                if (result.success) {\n                    // Step 2: Verify token\n                    steps.push('3. Verifying token...');\n                    const verification = await window.EdgeAuth.verifyToken();\n                    steps.push(`4. Token verification: ${verification.valid ? 'VALID' : 'INVALID'}`);\n                    \n                    // Step 3: Make authenticated request\n                    steps.push('5. Testing authenticated request...');\n                    try {\n                        const authResponse = await window.EdgeAuth.apiRequest('/api/test-edge');\n                        steps.push(`6. Authenticated request: ${authResponse.ok ? 'SUCCESS' : 'FAILED'}`);\n                    } catch (e) {\n                        steps.push(`6. Authenticated request: ERROR - ${e.message}`);\n                    }\n                    \n                    // Step 4: Logout\n                    steps.push('7. Testing logout...');\n                    await window.EdgeAuth.logout();\n                    steps.push('8. Logout completed');\n                    \n                    updateTestCard('test-auth-flow', 'success', steps.join('\\n'));\n                } else {\n                    updateTestCard('test-auth-flow', 'error', steps.join('\\n'));\n                }\n            } catch (error) {\n                steps.push(`ERROR: ${error.message}`);\n                updateTestCard('test-auth-flow', 'error', steps.join('\\n'));\n            }\n            \n            updateAuthStatus();\n        }\n\n        // Test protected routes\n        async function testProtectedRoute(path) {\n            updateTestCard('test-protected', 'pending', `Testing protected route: ${path}...`);\n            \n            try {\n                const token = window.EdgeAuth.getToken();\n                const headers = {};\n                \n                if (token) {\n                    headers['Authorization'] = `Bearer ${token}`;\n                }\n                \n                const response = await fetch(path, { headers });\n                \n                const result = {\n                    path: path,\n                    status: response.status,\n                    statusText: response.statusText,\n                    authenticated: !!token,\n                    headers: Object.fromEntries(response.headers.entries())\n                };\n                \n                const status = response.status === 401 ? 'success' : (response.ok ? 'success' : 'error');\n                updateTestCard('test-protected', status, JSON.stringify(result, null, 2));\n            } catch (error) {\n                updateTestCard('test-protected', 'error', `Error: ${error.message}`);\n            }\n        }\n\n        // Test individual login\n        async function testLogin() {\n            const username = document.getElementById('test-username').value;\n            const password = document.getElementById('test-password').value;\n            \n            try {\n                const result = await window.EdgeAuth.login(username, password);\n                console.log('Login result:', result);\n                updateAuthStatus();\n            } catch (error) {\n                console.error('Login error:', error);\n            }\n        }\n\n        // Test token verification\n        async function testVerify() {\n            try {\n                const result = await window.EdgeAuth.verifyToken();\n                console.log('Verify result:', result);\n            } catch (error) {\n                console.error('Verify error:', error);\n            }\n        }\n\n        // Test logout\n        async function testLogout() {\n            try {\n                await window.EdgeAuth.logout();\n                console.log('Logout completed');\n                updateAuthStatus();\n            } catch (error) {\n                console.error('Logout error:', error);\n            }\n        }\n\n        // Update test card UI\n        function updateTestCard(cardId, status, result) {\n            const card = document.getElementById(cardId);\n            const indicator = card.querySelector('.status-indicator');\n            const resultDiv = card.querySelector('.test-result');\n            \n            card.className = `test-card ${status}`;\n            indicator.className = `status-indicator ${status}`;\n            resultDiv.textContent = result;\n        }\n\n        // Initialize\n        document.addEventListener('DOMContentLoaded', function() {\n            updateAuthStatus();\n        });\n    </script>\n</body>\n</html>"