<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Analytics Dashboard</title>
    <link rel="stylesheet" href="design-system.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.28.0/index.min.js"></script>
    <style>
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .metric-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--warning); }
        
        .chart-container {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .insight-card {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .alert-high { border-left: 4px solid var(--danger); }
        .alert-medium { border-left: 4px solid var(--warning); }
        .alert-low { border-left: 4px solid var(--success); }
        
        .real-time-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: var(--success);
            color: white;
            border-radius: 20px;
            font-size: 0.8em;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .filters-bar {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-light);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table th {
            background: var(--bg-dark);
            font-weight: 600;
        }
        
        .employer-signal {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        .signal-high { background: var(--danger-light); color: var(--danger); }
        .signal-medium { background: var(--warning-light); color: var(--warning); }
        .signal-low { background: var(--success-light); color: var(--success); }
        
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification-toast.show {
            transform: translateX(0);
        }
        
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>üöÄ Portfolio Analytics</h1>
        <p style="color: var(--text-muted); margin-bottom: 20px;">Advanced Portfolio Insights</p>
        
        <nav class="sidebar-nav">
            <div class="nav-section">
                <h4>Analytics</h4>
                <ul>
                    <li><a href="#overview" class="nav-link active">üìä Overview</a></li>
                    <li><a href="#visitor-interest" class="nav-link">üë• Visitor Interest</a></li>
                    <li><a href="#employer-analysis" class="nav-link">üíº Employer Analysis</a></li>
                    <li><a href="#content-effectiveness" class="nav-link">üìÑ Content Performance</a></li>
                    <li><a href="#conversions" class="nav-link">üéØ Conversions</a></li>
                    <li><a href="#geographic" class="nav-link">üåç Geographic</a></li>
                    <li><a href="#technology-trends" class="nav-link">üíª Tech Trends</a></li>
                    <li><a href="#real-time" class="nav-link">‚ö° Real-time</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h4>Reports</h4>
                <ul>
                    <li><a href="#reports" class="nav-link">üìã Generate Reports</a></li>
                    <li><a href="#scheduled" class="nav-link">‚è∞ Scheduled Reports</a></li>
                </ul>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <div class="real-time-indicator">
                <span style="width: 8px; height: 8px; background: currentColor; border-radius: 50%;"></span>
                Live Data
            </div>
            <div style="margin-top: 10px; font-size: 0.8em; color: var(--text-muted);">
                Last updated: <span id="last-updated">--</span>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <!-- Filters Bar -->
        <div class="filters-bar">
            <div class="filter-group">
                <label>Time Period</label>
                <select id="period-filter" class="form-control">
                    <option value="7d">Last 7 days</option>
                    <option value="30d" selected>Last 30 days</option>
                    <option value="90d">Last 90 days</option>
                    <option value="1y">Last year</option>
                    <option value="custom">Custom range</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Content Type</label>
                <select id="content-filter" class="form-control">
                    <option value="all">All Content</option>
                    <option value="project">Projects</option>
                    <option value="blog">Blog Posts</option>
                    <option value="tool">Tools</option>
                    <option value="about">About</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Visitor Type</label>
                <select id="visitor-filter" class="form-control">
                    <option value="all">All Visitors</option>
                    <option value="new">New Visitors</option>
                    <option value="returning">Returning</option>
                    <option value="employer">Potential Employers</option>
                </select>
            </div>
            
            <div class="export-options">
                <button class="btn btn-primary" onclick="exportReport('pdf')">üìÑ PDF</button>
                <button class="btn btn-secondary" onclick="exportReport('excel')">üìä Excel</button>
                <button class="btn btn-outline" onclick="exportReport('csv')">üìã CSV</button>
            </div>
            
            <div class="loading-spinner" id="loading-spinner"></div>
        </div>

        <!-- Overview Section -->
        <section id="overview" class="analytics-section">
            <h2>Portfolio Analytics Overview</h2>
            
            <!-- Key Metrics -->
            <div class="analytics-grid">
                <div class="metric-card">
                    <h3>Project Views</h3>
                    <div class="metric-value" id="project-views">--</div>
                    <div class="metric-trend" id="project-views-trend">
                        <span>üìà</span> Loading...
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>Employer Interest</h3>
                    <div class="metric-value" id="employer-interest">--</div>
                    <div class="metric-trend" id="employer-interest-trend">
                        <span>üíº</span> Loading...
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>Conversion Rate</h3>
                    <div class="metric-value" id="conversion-rate">--</div>
                    <div class="metric-trend" id="conversion-rate-trend">
                        <span>üéØ</span> Loading...
                    </div>
                </div>
                
                <div class="metric-card">
                    <h3>Geographic Reach</h3>
                    <div class="metric-value" id="geographic-reach">--</div>
                    <div class="metric-trend" id="geographic-trend">
                        <span>üåç</span> Loading...
                    </div>
                </div>
            </div>
            
            <!-- Key Insights -->
            <div class="insight-card" id="key-insights">
                <h3>üéØ Key Insights</h3>
                <ul id="insights-list">
                    <li>Loading insights...</li>
                </ul>
            </div>
            
            <!-- Charts -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div class="chart-container">
                    <h3>Visitor Interest Over Time</h3>
                    <div class="chart-wrapper">
                        <canvas id="visitor-interest-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Top Technologies</h3>
                    <div class="chart-wrapper">
                        <canvas id="tech-interest-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visitor Interest Section -->
        <section id="visitor-interest" class="analytics-section" style="display: none;">
            <h2>Visitor Interest Analysis</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div class="chart-container">
                    <h3>Most Viewed Projects</h3>
                    <div class="chart-wrapper">
                        <canvas id="project-views-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Skill Interest Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="skill-distribution-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Project Engagement Details</h3>
                <table class="data-table" id="project-engagement-table">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>Views</th>
                            <th>Avg Time</th>
                            <th>Engagement Score</th>
                            <th>Technologies</th>
                            <th>Employer Interest</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Employer Analysis Section -->
        <section id="employer-analysis" class="analytics-section" style="display: none;">
            <h2>Employer & Client Behavior Analysis</h2>
            
            <div class="analytics-grid">
                <div class="metric-card alert-high">
                    <h3>High-Value Visitors</h3>
                    <div class="metric-value" id="high-value-visitors">--</div>
                    <p>Visitors with employer behavior patterns</p>
                </div>
                
                <div class="metric-card alert-medium">
                    <h3>Resume Downloads</h3>
                    <div class="metric-value" id="resume-downloads">--</div>
                    <p>Strong hiring interest indicator</p>
                </div>
                
                <div class="metric-card alert-low">
                    <h3>Contact Form Starts</h3>
                    <div class="metric-value" id="contact-starts">--</div>
                    <p>Initiated contact processes</p>
                </div>
                
                <div class="metric-card">
                    <h3>LinkedIn Profile Clicks</h3>
                    <div class="metric-value" id="linkedin-clicks">--</div>
                    <p>Professional network interest</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div class="chart-container">
                    <h3>Employer Behavior Timeline</h3>
                    <div class="chart-wrapper">
                        <canvas id="employer-timeline-chart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Traffic Sources</h3>
                    <div class="chart-wrapper">
                        <canvas id="traffic-sources-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Recent High-Value Sessions</h3>
                <table class="data-table" id="high-value-sessions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Source</th>
                            <th>Employer Score</th>
                            <th>Actions</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6">Loading sessions...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Real-time Section -->
        <section id="real-time" class="analytics-section" style="display: none;">
            <h2>Real-time Engagement</h2>
            
            <div class="analytics-grid">
                <div class="metric-card">
                    <h3>Active Users</h3>
                    <div class="metric-value" id="active-users">--</div>
                    <p>Currently viewing portfolio</p>
                </div>
                
                <div class="metric-card">
                    <h3>Last 5 Minutes</h3>
                    <div class="metric-value" id="recent-events">--</div>
                    <p>Events tracked</p>
                </div>
                
                <div class="metric-card alert-high">
                    <h3>High-Value Alerts</h3>
                    <div class="metric-value" id="high-value-alerts">--</div>
                    <p>Potential opportunities</p>
                </div>
                
                <div class="metric-card">
                    <h3>Current Top Page</h3>
                    <div class="metric-value" id="current-top-page" style="font-size: 1.2em;">--</div>
                    <p>Most active page right now</p>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>Live Activity Feed</h3>
                <div id="activity-feed" style="max-height: 400px; overflow-y: auto;">
                    <p>Loading real-time data...</p>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="analytics-section" style="display: none;">
            <h2>Generate Portfolio Reports</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                <div class="chart-container">
                    <h3>Report Options</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Report Type</label>
                        <select id="report-type" class="form-control">
                            <option value="comprehensive">Comprehensive Report</option>
                            <option value="visitor-interest">Visitor Interest</option>
                            <option value="employer-analysis">Employer Analysis</option>
                            <option value="content-effectiveness">Content Effectiveness</option>
                            <option value="conversion-tracking">Conversion Tracking</option>
                            <option value="geographic-analysis">Geographic Analysis</option>
                            <option value="technology-trends">Technology Trends</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Format</label>
                        <select id="report-format" class="form-control">
                            <option value="pdf">PDF Report</option>
                            <option value="xlsx">Excel Spreadsheet</option>
                            <option value="csv">CSV Data</option>
                            <option value="json">JSON Data</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label>Email Report</label>
                        <input type="email" id="report-email" class="form-control" placeholder="Optional: your@email.com">
                    </div>
                    
                    <button class="btn btn-primary btn-block" onclick="generateCustomReport()">
                        üìä Generate Report
                    </button>
                </div>
                
                <div class="chart-container">
                    <h3>Recent Reports</h3>
                    <div id="recent-reports">
                        <p>No recent reports found.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Notification Toast -->
    <div class="notification-toast" id="notification-toast">
        <span id="notification-message"></span>
    </div>

    <script>
        class PortfolioAnalyticsDashboard {
            constructor() {
                this.apiBase = '/api/v2/analytics/portfolio';
                this.currentPeriod = '30d';
                this.charts = {};
                this.realTimeInterval = null;
                
                this.init();
            }

            async init() {
                this.setupNavigation();
                this.setupFilters();
                this.setupEventListeners();
                
                await this.loadOverviewData();
                this.startRealTimeUpdates();
                
                this.updateLastUpdated();
            }

            setupNavigation() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = link.getAttribute('href').substring(1);
                        this.showSection(sectionId);
                        
                        // Update active nav
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                });
            }

            setupFilters() {
                document.getElementById('period-filter').addEventListener('change', (e) => {
                    this.currentPeriod = e.target.value;
                    this.refreshData();
                });
                
                document.getElementById('content-filter').addEventListener('change', () => {
                    this.refreshData();
                });
                
                document.getElementById('visitor-filter').addEventListener('change', () => {
                    this.refreshData();
                });
            }

            setupEventListeners() {
                // Auto-refresh every 5 minutes
                setInterval(() => {
                    this.refreshData();
                }, 5 * 60 * 1000);
            }

            showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('.analytics-section').forEach(section => {
                    section.style.display = 'none';
                });
                
                // Show target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    
                    // Load section-specific data
                    this.loadSectionData(sectionId);
                }
            }

            async loadOverviewData() {
                this.showLoading(true);
                
                try {
                    const response = await fetch(`${this.apiBase}/dashboard?period=${this.currentPeriod}`);
                    const data = await response.json();
                    
                    this.updateOverviewMetrics(data);
                    this.updateInsights(data);
                    this.createOverviewCharts(data);
                    
                } catch (error) {
                    console.error('Failed to load overview data:', error);
                    this.showNotification('Failed to load analytics data', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            updateOverviewMetrics(data) {
                const overview = data.overview || {};
                
                document.getElementById('project-views').textContent = 
                    overview.visitorInterest?.totalProjects || '--';
                
                document.getElementById('employer-interest').textContent = 
                    overview.employerActivity?.potentialEmployers || '--';
                
                document.getElementById('conversion-rate').textContent = 
                    ((overview.employerActivity?.conversionRate || 0) * 100).toFixed(1) + '%';
                
                document.getElementById('geographic-reach').textContent = 
                    overview.geographic?.totalCountries || '--';
                
                // Update trends (simplified)
                this.updateTrend('project-views-trend', '+12%', 'up');
                this.updateTrend('employer-interest-trend', '+5%', 'up');
                this.updateTrend('conversion-rate-trend', '-2%', 'down');
                this.updateTrend('geographic-trend', '+8%', 'up');
            }

            updateTrend(elementId, change, direction) {
                const element = document.getElementById(elementId);
                const icon = direction === 'up' ? 'üìà' : direction === 'down' ? 'üìâ' : 'üìä';
                const className = `trend-${direction}`;
                
                element.innerHTML = `<span>${icon}</span> ${change} vs last period`;
                element.className = `metric-trend ${className}`;
            }

            updateInsights(data) {
                const insights = [];
                
                if (data.overview?.visitorInterest?.totalProjects > 0) {
                    insights.push(`Portfolio showcases ${data.overview.visitorInterest.totalProjects} active projects`);
                }
                
                if (data.overview?.employerActivity?.potentialEmployers > 0) {
                    insights.push(`${data.overview.employerActivity.potentialEmployers} potential employer visits detected this period`);
                }
                
                if (data.overview?.geographic?.internationalPercentage > 50) {
                    insights.push(`Strong international reach with ${data.overview.geographic.internationalPercentage}% international visitors`);
                }
                
                if (data.overview?.technology?.trendingTechnologies?.length > 0) {
                    const topTech = data.overview.technology.trendingTechnologies[0];
                    insights.push(`${topTech.name || topTech} is trending among visitors`);
                }
                
                if (insights.length === 0) {
                    insights.push('Continue building great content to generate insights');
                }
                
                const insightsList = document.getElementById('insights-list');
                insightsList.innerHTML = insights.map(insight => `<li>${insight}</li>`).join('');
            }

            createOverviewCharts(data) {
                this.createVisitorInterestChart(data);
                this.createTechInterestChart(data);
            }

            createVisitorInterestChart(data) {
                const ctx = document.getElementById('visitor-interest-chart').getContext('2d');
                
                if (this.charts.visitorInterest) {
                    this.charts.visitorInterest.destroy();
                }
                
                // Generate sample data for demonstration
                const labels = this.generateDateLabels(this.currentPeriod);
                const visitorData = this.generateSampleData(labels.length, 50, 200);
                const employerData = this.generateSampleData(labels.length, 5, 25);
                
                this.charts.visitorInterest = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Total Visitors',
                                data: visitorData,
                                borderColor: 'rgb(54, 162, 235)',
                                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                tension: 0.1
                            },
                            {
                                label: 'Potential Employers',
                                data: employerData,
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            createTechInterestChart(data) {
                const ctx = document.getElementById('tech-interest-chart').getContext('2d');
                
                if (this.charts.techInterest) {
                    this.charts.techInterest.destroy();
                }
                
                const technologies = data.overview?.technology?.trendingTechnologies || [
                    { name: 'JavaScript', interest: 85 },
                    { name: 'React', interest: 75 },
                    { name: 'Node.js', interest: 65 },
                    { name: 'Python', interest: 55 },
                    { name: 'Docker', interest: 45 }
                ];
                
                this.charts.techInterest = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: technologies.slice(0, 5).map(tech => tech.name || tech),
                        datasets: [{
                            data: technologies.slice(0, 5).map(tech => tech.interest || Math.random() * 100),
                            backgroundColor: [
                                '#FF6384',
                                '#36A2EB',
                                '#FFCE56',
                                '#4BC0C0',
                                '#9966FF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            async loadSectionData(sectionId) {
                switch (sectionId) {
                    case 'visitor-interest':
                        await this.loadVisitorInterestData();
                        break;
                    case 'employer-analysis':
                        await this.loadEmployerAnalysisData();
                        break;
                    case 'real-time':
                        await this.loadRealTimeData();
                        break;
                    // Add other sections as needed
                }
            }

            async loadVisitorInterestData() {
                try {
                    const response = await fetch(`${this.apiBase}/visitor-interest?period=${this.currentPeriod}`);
                    const data = await response.json();
                    
                    this.updateVisitorInterestSection(data);
                } catch (error) {
                    console.error('Failed to load visitor interest data:', error);
                }
            }

            async loadEmployerAnalysisData() {
                try {
                    const response = await fetch(`${this.apiBase}/employer-analysis?period=${this.currentPeriod}`);
                    const data = await response.json();
                    
                    this.updateEmployerAnalysisSection(data);
                } catch (error) {
                    console.error('Failed to load employer analysis data:', error);
                }
            }

            async loadRealTimeData() {
                try {
                    const response = await fetch(`${this.apiBase}/realtime`);
                    const data = await response.json();
                    
                    this.updateRealTimeSection(data);
                } catch (error) {
                    console.error('Failed to load real-time data:', error);
                }
            }

            updateVisitorInterestSection(data) {
                // Update project engagement table
                const table = document.getElementById('project-engagement-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                const projects = data.projects || this.generateSampleProjects();
                projects.forEach(project => {
                    const row = table.insertRow();
                    row.innerHTML = `
                        <td>${project.title}</td>
                        <td>${project.views}</td>
                        <td>${project.avgTime}s</td>
                        <td>${project.engagementScore}/100</td>
                        <td>${project.technologies.join(', ')}</td>
                        <td>
                            <span class="employer-signal signal-${project.employerInterest}">
                                ${project.employerInterest}
                            </span>
                        </td>
                    `;
                });
            }

            updateEmployerAnalysisSection(data) {
                const summary = data.summary || {};
                
                document.getElementById('high-value-visitors').textContent = summary.potentialEmployers || '--';
                document.getElementById('resume-downloads').textContent = summary.resumeDownloads || '--';
                document.getElementById('contact-starts').textContent = summary.contactStarts || '--';
                document.getElementById('linkedin-clicks').textContent = summary.linkedinClicks || '--';
                
                // Update high-value sessions table
                const table = document.getElementById('high-value-sessions-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                const sessions = data.sessions || this.generateSampleSessions();
                sessions.forEach(session => {
                    const row = table.insertRow();
                    row.innerHTML = `
                        <td>${new Date(session.date).toLocaleDateString()}</td>
                        <td>${session.location}</td>
                        <td>${session.source}</td>
                        <td>
                            <span class="employer-signal signal-${session.scoreLevel}">
                                ${session.score}%
                            </span>
                        </td>
                        <td>${session.actions.join(', ')}</td>
                        <td>${session.duration}</td>
                    `;
                });
            }

            updateRealTimeSection(data) {
                document.getElementById('active-users').textContent = data.activeUsers || 0;
                document.getElementById('recent-events').textContent = data.recentEvents?.length || 0;
                document.getElementById('high-value-alerts').textContent = data.highValueInteractions?.length || 0;
                document.getElementById('current-top-page').textContent = data.topPages?.[0]?.path || '/';
                
                // Update activity feed
                const feed = document.getElementById('activity-feed');
                feed.innerHTML = '';
                
                if (data.recentEvents && data.recentEvents.length > 0) {
                    data.recentEvents.forEach(event => {
                        const eventDiv = document.createElement('div');
                        eventDiv.style.cssText = 'padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.9em;';
                        
                        const icon = this.getEventIcon(event.eventType);
                        const time = new Date(event.timestamp).toLocaleTimeString();
                        
                        eventDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>${icon} ${event.action || event.eventType}</span>
                                <span style="color: var(--text-muted);">${time}</span>
                            </div>
                            <div style="margin-top: 5px; color: var(--text-muted); font-size: 0.8em;">
                                ${event.country || 'Unknown'} ‚Ä¢ ${event.path || event.url}
                            </div>
                        `;
                        
                        feed.appendChild(eventDiv);
                    });
                } else {
                    feed.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No recent activity</p>';
                }
            }

            getEventIcon(eventType) {
                const icons = {
                    'pageview': 'üëÄ',
                    'project_view': 'üéØ',
                    'conversion': '‚úÖ',
                    'employer_signal': 'üíº',
                    'download': '‚¨áÔ∏è',
                    'contact': 'üìß',
                    'social_click': 'üîó'
                };
                return icons[eventType] || 'üìä';
            }

            startRealTimeUpdates() {
                // Update real-time data every 30 seconds if on real-time section
                this.realTimeInterval = setInterval(() => {
                    const activeSection = document.querySelector('.analytics-section:not([style*="display: none"])');
                    if (activeSection && activeSection.id === 'real-time') {
                        this.loadRealTimeData();
                    }
                }, 30000);
            }

            async refreshData() {
                const activeSection = document.querySelector('.analytics-section:not([style*="display: none"])');
                if (activeSection) {
                    if (activeSection.id === 'overview') {
                        await this.loadOverviewData();
                    } else {
                        await this.loadSectionData(activeSection.id);
                    }
                }
                this.updateLastUpdated();
            }

            showLoading(show) {
                const spinner = document.getElementById('loading-spinner');
                spinner.style.display = show ? 'block' : 'none';
            }

            showNotification(message, type = 'info') {
                const toast = document.getElementById('notification-toast');
                const messageEl = document.getElementById('notification-message');
                
                messageEl.textContent = message;
                toast.className = `notification-toast ${type} show`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            updateLastUpdated() {
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
            }

            // Utility methods for generating sample data
            generateDateLabels(period) {
                const labels = [];
                const days = period === '7d' ? 7 : period === '30d' ? 30 : 90;
                
                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString());
                }
                
                return labels;
            }

            generateSampleData(length, min, max) {
                const data = [];
                for (let i = 0; i < length; i++) {
                    data.push(Math.floor(Math.random() * (max - min + 1)) + min);
                }
                return data;
            }

            generateSampleProjects() {
                return [
                    {
                        title: 'E-commerce Platform',
                        views: 245,
                        avgTime: 180,
                        engagementScore: 85,
                        technologies: ['React', 'Node.js', 'MongoDB'],
                        employerInterest: 'high'
                    },
                    {
                        title: 'Task Management App',
                        views: 189,
                        avgTime: 145,
                        engagementScore: 72,
                        technologies: ['Vue.js', 'Python', 'PostgreSQL'],
                        employerInterest: 'medium'
                    },
                    {
                        title: 'Data Visualization Dashboard',
                        views: 156,
                        avgTime: 220,
                        engagementScore: 91,
                        technologies: ['D3.js', 'React', 'GraphQL'],
                        employerInterest: 'high'
                    }
                ];
            }

            generateSampleSessions() {
                return [
                    {
                        date: new Date(),
                        location: 'San Francisco, US',
                        source: 'LinkedIn',
                        score: 92,
                        scoreLevel: 'high',
                        actions: ['Resume Download', 'Contact Form'],
                        duration: '8m 32s'
                    },
                    {
                        date: new Date(Date.now() - 86400000),
                        location: 'London, UK',
                        source: 'Google',
                        score: 78,
                        scoreLevel: 'medium',
                        actions: ['Project View', 'LinkedIn Click'],
                        duration: '12m 15s'
                    }
                ];
            }
        }

        // Global functions for buttons
        async function exportReport(format) {
            const dashboard = window.portfolioDashboard;
            if (dashboard) {
                dashboard.showLoading(true);
                try {
                    const response = await fetch(`${dashboard.apiBase}/reports?type=comprehensive&format=${format}&period=${dashboard.currentPeriod}`);
                    
                    if (format === 'json') {
                        const data = await response.json();
                        console.log('Report data:', data);
                        dashboard.showNotification('Report generated successfully');
                    } else {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `portfolio-report-${Date.now()}.${format}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        dashboard.showNotification(`${format.toUpperCase()} report downloaded`);
                    }
                } catch (error) {
                    console.error('Export failed:', error);
                    dashboard.showNotification('Export failed', 'error');
                } finally {
                    dashboard.showLoading(false);
                }
            }
        }

        async function generateCustomReport() {
            const dashboard = window.portfolioDashboard;
            if (dashboard) {
                const type = document.getElementById('report-type').value;
                const format = document.getElementById('report-format').value;
                const email = document.getElementById('report-email').value;
                
                dashboard.showLoading(true);
                try {
                    const params = new URLSearchParams({
                        type,
                        format,
                        period: dashboard.currentPeriod
                    });
                    
                    if (email) params.append('email', email);
                    
                    const response = await fetch(`${dashboard.apiBase}/reports?${params}`);
                    
                    if (email) {
                        dashboard.showNotification('Report will be emailed to you shortly');
                    } else if (format === 'json') {
                        const data = await response.json();
                        console.log('Report data:', data);
                        dashboard.showNotification('Report generated successfully');
                    } else {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `portfolio-${type}-${Date.now()}.${format}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        dashboard.showNotification(`${format.toUpperCase()} report downloaded`);
                    }
                } catch (error) {
                    console.error('Report generation failed:', error);
                    dashboard.showNotification('Report generation failed', 'error');
                } finally {
                    dashboard.showLoading(false);
                }
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.portfolioDashboard = new PortfolioAnalyticsDashboard();
        });
    </script>
</body>
</html>